/*!
 * ui.checkSwitch
 *
 * @version      0.12
 * @author       nori (norimania@gmail.com)
 * @copyright    5509 (http://5509.me/)
 * @license      The MIT License
 * @link         https://github.com/5509/ui.checkSwitch
 *
 * 2012-04:07 03:10
 */(function(a,b){function h(a,b){this.namespace="CheckSwitch";return this instanceof h?this.init(a,b):new h(a,b)}function i(a,b,c){var d=c;a.attachEvent("on"+b,d);return{detach:function(){a.detachEvent("on"+b,d)}}}function j(a,c){var d;if("createEvent"in b){d=b.createEvent("UIEvents");d.initEvent(c,!1,!0);a.dispatchEvent(d)}else if("createEventObject"in b){d=b.createEventObject();d.name=c;a.fireEvent("ondataavailable",d)}}function k(b,c,d){a.addEventListener?b.addEventListener(c,d,!1):b[c]?b.attachEvent("on"+c,d):b.attachEvent("ondataavailable",function(a){a.func=a.func||{};a.func[c]=d;if(!a.func[a.name])return;a.func[a.name]();a.name=null})}function l(a,d){var e=undefined,f=b.body,g=b.documentElement;c?pagePos=a.changedTouches[0][d]:a[d]?pagePos=a[d]:d==="pageX"?pagePos=a.clientX+f.scrollLeft+g.scrollLeft:pagePos=a.clientY+f.scrollTop+g.scrollTop;return pagePos}function m(a,b){var c=undefined;for(c in b)a.style[c]=b[c]}function n(a,b){var c=undefined;for(c in b){if(!(c in a))break;a[c]=b[c]}return a}function o(a,b){b.parentNode.insertBefore(a,b.nextSibling)}function p(a,b){var c=undefined,d=r(b.namespace),e=undefined;for(c in b){if(typeof b[c]!="function"||/(?:^_)|(?:^handleEvent$)|(?:^init$)/.test(c))continue;e=d+q(c);a[e]=function(){var a=c;return function(c){return b[a](c)}}()}}function q(a){return a.replace(/(^[a-z])/,function(a){return a.toUpperCase()})}function r(a){return a.replace(/(^[A-Z])/,function(a){return a.toLowerCase()})}var c="ontouchstart"in a,d="addEventListener"in a,e=c?"touchstart":"mousedown",f=c?"touchmove":"mousemove",g=c?"touchend":"mouseup";h.prototype={init:function(a,c){var d=this;typeof a=="string"?d.elem=b.getElementById(a.replace("#","")):d.elem=a;if(d.elem.nodeName!=="INPUT"||d.elem.type!=="checkbox")throw Error("You can't use "+d.namespace+" for except input[type=checkbox]");d.conf=n({duration:"0.2s",timingFunction:"cubic-bezier(0,0,0.25,1)",trigger:10,checkOnText:"ON",checkOffText:"OFF",uiClass:"ui_check_switch",uiOnClass:"ui_check_switch_on",uiOffClass:"ui_check_switch_off",uiInnerClass:"ui_check_switch_inner",uiSliderClass:"ui_check_switch_slider",uiTextClass:"ui_check_text",uiKnobClass:"ui_check_knob",uiCheckOffClass:"ui_check_off",uiCheckOnClass:"ui_check_on"},c||{});d.onClass=d.conf.uiClass+" "+d.conf.uiOnClass;d.offClass=d.conf.uiClass+" "+d.conf.uiOffClass;d.elemDefDisplay=undefined;d.elem.currentStyle?d.elemDefDisplay=d.elem.currentStyle.display:d.elemDefDisplay=getComputedStyle(d.elem).display;d.state=!1;d.touchEnabled=!0;d.currentPoint=0;d.currentX=0;d.maxX=d.elem.offsetWidth;d.disabled=!1;d.destroyed=!1;d._view();d._setHandle()},_setHandle:function(){var a=this;if(d){a.view.addEventListener(e,a,!1);b.addEventListener(f,a,!1);b.addEventListener(g,a,!1)}else{a.handledStart=i(a.view,e,function(b){a._touchstart(b)});a.handledMove=i(b,f,function(b){a._touchmove(b)});a.handledEnd=i(b,g,function(b){a._touchend(b)})}},handleEvent:function(a){var b=this;switch(a.type){case e:b._touchStart(a);break;case f:b._touchMove(a);break;case g:b._touchEnd(a);break;case"click":b._click(a)}},_touchStart:function(a){var b=this;if(!b.touchEnabled||b.disabled)return;c||(d?a.preventDefault():a.returnValue=!1);b.scrolling=!0;b.moveReady=!1;b.startPageX=l(a,"pageX");b.startPageY=l(a,"pageY");b.basePageX=b.startPageX;b.directionX=0;b.startTime=a.timeStamp},_touchMove:function(a){var b=this,c=undefined,e=undefined,f=undefined,g=undefined,h=undefined,i=undefined;if(!b.scrolling)return;c=l(a,"pageX");e=l(a,"pageY");if(b.moveReady){if(d){a.preventDefault();a.stopPropagation()}else{a.returnValue=!1;a.cancelBubble=!0}f=c-b.basePageX;b.directionX=f;b._moving();b._slide(b.directionX)}else{h=Math.abs(c-b.startPageX);i=Math.abs(e-b.startPageY);if(h>5){if(d){a.preventDefault();a.stopPropagation()}else{a.returnValue=!1;a.cancelBubble=!0}b.moveReady=!0}else i>5&&(b.scrolling=!1)}b.basePageX=c},_touchEnd:function(a){var b=this,c=b.conf;if(!b.scrolling)return;b.moveReady?b.getState()?b.sliderCurrent<=-b.range/2?b._off():b._on():-b.range/2<=b.sliderCurrent?b._on():b._off():b.getState()?b._off():b._on();b.scrolling=!1},_view:function(){var a=this,c=a.conf;a.view=b.createElement("span");a.view.className=c.uiClass;a.view.innerHTML=['<span class="'+c.uiInnerClass+'">','<span class="'+c.uiSliderClass+'">','<span class="'+c.uiCheckOnClass," "+c.uiTextClass,'">'+c.checkOnText+"</span>",'<span class="'+c.uiKnobClass+'"></span>','<span class="'+c.uiCheckOffClass," "+c.uiTextClass,'">'+c.checkOffText+"</span>","</span>","</span>"].join("");a.slider=a.view.childNodes[0].childNodes[0];a.knob=a.slider.childNodes[1];o(a.view,a.elem);m(a.elem,{display:"none"});a.range=(a.slider.offsetWidth-a.knob.offsetWidth)/2;a.sliderCurrent=a.getState()?0:-a.range;a._setSliderPos(a.sliderCurrent);setTimeout(function(){a.getState()?a._on():a._off()},0);return a.view},_slide:function(a){var b=this,c=b.sliderCurrent,d=c+a;d>=0?d=0:d<=-b.range&&(d=-b.range);b.sliderCurrent=d;b._setSliderPos(d)},_moving:function(){var a=this;a.view.className=a.conf.uiClass},_setSliderPos:function(a){var b=this;b.sliderCurrent=a;m(b.slider,{marginLeft:a+"px"})},_on:function(){var a=this,b=a.conf,c=b.uiClass+" "+b.uiOnClass;a.setState(!0);a.currentX=0;a._setSliderPos(0);a.view.className=c;j(a.view,"checkSwitch:on")},_off:function(){var a=this,b=a.conf,c=b.uiClass+" "+b.uiOffClass;a.setState(!1);a.currentX=-a.range;a._setSliderPos(-a.range);a.view.className=c;j(a.view,"checkSwitch:off")},getState:function(){var a=this;return a.elem.checked?!0:!1},setState:function(a){var b=this;b.elem.checked=a?"checked":""},on:function(){var a=this;a._on()},off:function(){var a=this;a._off()},bind:function(a){var b=this,c=undefined;for(c in a)k(b.view,c,a[c])},destroy:function(){var a=this;if(d){b.removeEventListener(f,a,!1);b.removeEventListener(g,a,!1)}else{a.handledMove.detach();a.handledEnd.detach()}a.view.parentNode.removeChild(a.view);m(a.elem,{display:a.elemDefDisplay})}};a.CheckSwitch=h})(this,this.document);