/*!
 * ui.checkSwitch
 *
 * @version      0.12
 * @author       nori (norimania@gmail.com)
 * @copyright    5509 (http://5509.me/)
 * @license      The MIT License
 * @link         https://github.com/5509/ui.checkSwitch
 *
 * 2012-04:07 03:10
 */(function(a,b,c){function i(a,b){this.namespace="CheckSwitch";return this instanceof i?this.init(a,b):new i(a,b)}function j(a,b,c){var d=c;a.attachEvent("on"+b,d);return{detach:function(){a.detachEvent("on"+b,d)}}}function k(a,c,d){var e;if("createEvent"in b){e=b.createEvent("UIEvents");e.initEvent(c,!1,!0);e.checkSwitch=d;a.dispatchEvent(e)}else if("createEventObject"in b){e=b.createEventObject();e.name=c;e.checkSwitch=d;a.fireEvent("ondataavailable",e)}}function l(b,c,d){a.addEventListener?b.addEventListener(c,d,!1):b[c]?b.attachEvent("on"+c,d):b.attachEvent("ondataavailable",function(a){a.func=a.func||{};a.func[c]=d;if(!a.func[a.name])return;a.func[a.name](a);a.name=null})}function m(a,e){var f=c,g=b.body,h=b.documentElement;d?pagePos=a.changedTouches[0][e]:a[e]?pagePos=a[e]:e==="pageX"?pagePos=a.clientX+g.scrollLeft+h.scrollLeft:pagePos=a.clientY+g.scrollTop+h.scrollTop;return pagePos}function n(a,b){var d=c;for(d in b)a.style[d]=b[d]}function o(a,b){var d=c;for(d in b){if(!(d in a))break;a[d]=b[d]}return a}function p(a,b){var d=c,e=r(b.namespace),f=c;for(d in b){if(typeof b[d]!="function"||/(?:^_)|(?:^handleEvent$)|(?:^init$)/.test(d))continue;f=e+q(d);a[f]=function(){var a=d;return function(c){return b[a](c)}}()}}function q(a){return a.replace(/(^[a-z])/,function(a){return a.toUpperCase()})}function r(a){return a.replace(/(^[A-Z])/,function(a){return a.toLowerCase()})}var d="ontouchstart"in a,e="addEventListener"in a,f=d?"touchstart":"mousedown",g=d?"touchmove":"mousemove",h=d?"touchend":"mouseup";i.prototype={init:function(a,d){var e=this;typeof a=="string"?e.elem=b.getElementById(a.replace("#","")):e.elem=a;if(e.elem.nodeName!=="INPUT"||e.elem.type!=="checkbox")throw Error("You can't use "+e.namespace+" for except input[type=checkbox]");e.conf=o({checkOnText:"ON",checkOffText:"OFF",uiClass:"ui_check_switch",uiOnClass:"ui_check_switch_on",uiOffClass:"ui_check_switch_off",uiInnerClass:"ui_check_switch_inner",uiSliderClass:"ui_check_switch_slider",uiTextClass:"ui_check_text",uiKnobClass:"ui_check_knob",uiCheckOffClass:"ui_check_off",uiCheckOnClass:"ui_check_on"},d||{});e.onClass=e.conf.uiClass+" "+e.conf.uiOnClass;e.offClass=e.conf.uiClass+" "+e.conf.uiOffClass;e.elemDefDisplay=c;e.elem.currentStyle?e.elemDefDisplay=e.elem.currentStyle.display:e.elemDefDisplay=getComputedStyle(e.elem).display;e.state=!1;e.touchEnabled=!0;e.currentPoint=0;e.currentX=0;e.maxX=e.elem.offsetWidth;e.disabled=!1;e.destroyed=!1;e._view();e._setHandle()},_setHandle:function(){var a=this;if(e){a.view.addEventListener(f,a,!1);b.addEventListener(g,a,!1);b.addEventListener(h,a,!1)}else{a.handledStart=j(a.view,f,function(b){a._touchStart(b)});a.handledMove=j(b.body,g,function(b){a._touchMove(b)});a.handledEnd=j(b.body,h,function(b){a._touchEnd(b)})}},handleEvent:function(a){var b=this;switch(a.type){case f:b._touchStart(a);break;case g:b._touchMove(a);break;case h:b._touchEnd(a);break;case"click":b._click(a)}},_touchStart:function(a){var b=this;if(!b.touchEnabled||b.disabled)return;d||(e?a.preventDefault():a.returnValue=!1);b.scrolling=!0;b.moveReady=!1;b.startPageX=m(a,"pageX");b.startPageY=m(a,"pageY");b.basePageX=b.startPageX;b.directionX=0;b.startTime=a.timeStamp},_touchMove:function(a){var b=this,d=c,f=c,g=c,h=c,i=c,j=c;if(!b.scrolling)return;d=m(a,"pageX");f=m(a,"pageY");if(b.moveReady){if(e){a.preventDefault();a.stopPropagation()}else{a.returnValue=!1;a.cancelBubble=!0}g=d-b.basePageX;b.directionX=g;b._moving();b._slide(b.directionX)}else{i=Math.abs(d-b.startPageX);j=Math.abs(f-b.startPageY);if(i>5){if(e){a.preventDefault();a.stopPropagation()}else{a.returnValue=!1;a.cancelBubble=!0}b.moveReady=!0}else j>5&&(b.scrolling=!1)}b.basePageX=d},_touchEnd:function(a){var b=this,c=b.conf;if(!b.scrolling)return;b.moveReady?b.getState()?b.sliderCurrent<=-b.range/2?b._off():b._on():-b.range/2<=b.sliderCurrent?b._on():b._off():b.getState()?b._off():b._on();b.scrolling=!1},_view:function(){var a=this,c=a.conf;a.view=b.createElement("span");a.view.className=c.uiClass;a.view.innerHTML=['<span class="'+c.uiInnerClass+'">','<span class="'+c.uiSliderClass+'">','<span class="'+c.uiCheckOnClass," "+c.uiTextClass,'">'+c.checkOnText+"</span>",'<span class="'+c.uiKnobClass+'"></span>','<span class="'+c.uiCheckOffClass," "+c.uiTextClass,'">'+c.checkOffText+"</span>","</span>","</span>"].join("");a.slider=a.view.childNodes[0].childNodes[0];a.knob=a.slider.childNodes[1];a.elem.parentNode.insertBefore(a.view,a.elem.nextSibling);n(a.elem,{display:"none"});a.range=(a.slider.offsetWidth-a.knob.offsetWidth)/2;a.sliderCurrent=a.getState()?0:-a.range;a._setSliderPos(a.sliderCurrent);setTimeout(function(){a.getState()?a._on():a._off()},0);return a.view},_slide:function(a){var b=this,c=b.sliderCurrent,d=c+a;d>=0?d=0:d<=-b.range&&(d=-b.range);b.sliderCurrent=d;b._setSliderPos(d)},_moving:function(){var a=this;a.view.className=a.conf.uiClass},_setSliderPos:function(a){var b=this;b.sliderCurrent=a;n(b.slider,{marginLeft:a+"px"})},_on:function(){var a=this,b=a.conf,c=b.uiClass+" "+b.uiOnClass;a._setState(!0);a.currentX=0;a._setSliderPos(0);a.view.className=c;k(a.view,"checkSwitch:on",{elem:a.elem,id:a.elem.id,name:a.elem.name})},_off:function(){var a=this,b=a.conf,c=b.uiClass+" "+b.uiOffClass;a._setState(!1);a.currentX=-a.range;a._setSliderPos(-a.range);a.view.className=c;k(a.view,"checkSwitch:off",{elem:a.elem,id:a.elem.id,name:a.elem.name})},_setState:function(a){var b=this;b.elem.checked=a?"checked":""},getState:function(){var a=this;return a.elem.checked?!0:!1},on:function(){var a=this;a._on()},off:function(){var a=this;a._off()},bind:function(a){var b=this,d=c;for(d in a)l(b.view,d,a[d])},destroy:function(){var a=this;if(e){b.removeEventListener(g,a,!1);b.removeEventListener(h,a,!1)}else{a.handledMove.detach();a.handledEnd.detach()}a.view.parentNode.removeChild(a.view);n(a.elem,{display:a.elemDefDisplay})}};a.CheckSwitch=i})(this,this.document);